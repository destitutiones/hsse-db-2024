# Материалы

- [Лекция 1](https://drive.google.com/file/d/1Z-idgiRrl3kAQTmlfq5BWTgyrl8zL6Ad/view?usp=sharing)

# Теория

## Введение

**База данных** – совокупность данных, хранимых в соответствии со схемой данных, манипулирование которыми выполняют в соответствии с правилами средств моделирования данных.

> База данных = набор данных + правила их хранения + правила их использования.

</aside>

**СУБД (система управления базами данных)** – совокупность программных и лингвистических средств, обеспечивающих управление созданием и использованием БД.

**Модель данных** – инструмент (ни о каких физических данных речи не идёт!), формальная теория представления и обработки данных в СУБД, включающая по меньшей мере три аспекта:

| Название аспекта | Сущность | Пояснение |
| --- | --- | --- |
| **Структуры** | Методы описания типов и логических структур данных в базе данных. | Данные в базе воспринимаются пользователем, как таблицы (и никак иначе). |
| **Манипуляции** | Методы манипулирования данными. | В распоряжении пользователя имеются операторы манипулирования таблицами (например, предназначенные для поиска данных), которые генерируют новые таблицы на основании уже имеющихся и среди которых есть, по крайней мере, операторы сокращения (restrict), проекции (project) и объединения (join). |
| **Целостности** | Методы описания и поддержки целостности базы данных. | Эти таблицы отвечают определенным условиям целостности (которые мы будем рассматривать позднее). |

**Иерархическая модель**

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/38893cb1-f7e5-4440-929f-38ed2df98ae8/0dbcd079-366e-4146-b4a0-6600fcf1bec8/Untitled.png)

- древовидная структура записей

**Сетевая модель**

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/38893cb1-f7e5-4440-929f-38ed2df98ae8/47f7f09d-2b48-4cde-b289-70f3b76c44ba/Untitled.png)

- структура записей в виде графа

## Реляционные БД

### Основные понятия

| Понятие | Определение | Простая аналогия |
| --- | --- | --- |
| Отношение | Математическая структура, которая формально определяет связи различных объектов и их взаимосвязи. | Таблица (в которой не определен порядок строк и столбцов, а также нет двух одинаковых строк). |
| Реляционная алгебра | Коллекция операций, которые принимают отношения в качестве операндов и возвращают отношение в качестве результата. | Набор функций, принимающих на вход одну или более таблиц и возвращающих таблицу. |
| Домен | Множество допустимых значений. |  |
| Атрибут | Наименование домена. | Название колонки таблицы. |
| Кортеж | Упорядоченный набор фиксированной длины. | Строка таблицы. |
| Арность отношения | Количество атрибутов отношения. | Количество столбцов в таблице. |
| Заголовок отношения | Список атрибутов. | Набор наименований колонок таблицы. |
| Тело отношения | Множество кортежей в составе отношения. | Все строки таблицы. |
| Совместимые домены | Совпадающие домены или такие, что один является подмножеством другого. |  |
| Составной домен | Домен, представляющий собой расширенное декартово произведение конечного числа простых доменов. |  |

**Упражнение**

Рассказать про структуру приведенного ниже отношения.

Выделить основные понятия: *отношение, атрибут, домен произвольных атрибутов, кортеж, арность, заголовок отношения, тело отношения*.

[Источник](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BC%D0%B8%D0%BB%D0%BB%D0%B8%D0%B0%D1%80%D0%B4%D0%B5%D1%80%D0%BE%D0%B2)

| № | Имя | Возраст | Состояние,(млрд, $) | Отрасль | Активы | Резиденция |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | Илон Маск | 50 | 244,2 | космонавтика,автомобиле-строение | SpaceXTesla |  США |
| 2 | Джефф Безос | 56 | 195,9 | онлайн-торговля | Amazon |  США |
| 3 | Бернар Арно | 72 | 190,3 | ритейл | LVMH |  Франция |
| 4 | Билл Гейтс | 66 | 136,4 | разработка программного обеспечения | Microsoft |  США |
| 5 | Ларри Эллисон | 77 | 127,9 | разработка программного обеспечения | Oracle |  США |
| 6 | Ларри Пейдж | 48 | 121,5 | интернет | Google |  США |
| 7 | Марк Цукерберг | 37 | 119,4 | интернет | Meta |  США |
| 8 | Сергей Брин | 48 | 117,1 | интернет | Google |  США |
| 9 | Уоррен Баффетт | 91 | 117,1 | инвестиции | Berkshire Hathaway |  США |
| 10 | Стив Балмер | 65 | 102,5 | разработка программного обеспечения | Microsoft |  США |

### Операции реляционной алгебры

- Полагаем, что отношение ≈ таблица (с определенными допущениями).
- В качестве элементарной единицы отношения используем кортеж (строку).
- Результатом выполнения операций реляционной алгебры является новое отношение.

**Теоретико-множественные операции**

- Объединение: UNION
- Пересечение: INTERSECT
- Разность: MINUS
- Декартово произведение: TIMES

**Реляционные операции**

- Ограничение: WHERE
- Проекция: PROJECT
- Соединение: JOIN
- Деление: DIVIDE BY

> Результат любой из операций выше – отношение. Это значит, что в результирующей таблице мы получаем только уникальные кортежи даже если “наивное” выполнение операции приводит к дублированию строк.

*Примеры см. в [лекции](https://drive.google.com/file/d/1Z-idgiRrl3kAQTmlfq5BWTgyrl8zL6Ad/view?usp=sharing).*

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/38893cb1-f7e5-4440-929f-38ed2df98ae8/23858d7b-6e4d-4d71-8890-7d9d3bca53df/Untitled.png)

**Естественное соединение** двух отношений $R_1$ и $R_2$ называется отношение, в котором заголовок является объединением заголовков $R_1$ и $R_2$ , а тело состоит из кортежей, полученных всевозможными соединениями кортежей $R_1$ и $R_2$ , имеющих равные значения одноимённых атрибутов. Обозначение: $R_1 \bowtie R_2$. 

### Вопросы

1. Какое свойство отношений требуется для применения операций объединения, пересечения и разности?
    <details>
      <summary>Ответ</summary>

      Совместимость.

    </details>

        
2. Какими математическими свойствами обладают рассмотренные теоретико-множественные операции?
    <details>
      <summary>Ответ</summary>

      Ассоциативность и коммутативность.

    </details>
        
3. Чему эквивалентна операция $A \text{ JOIN } B$ в случае отсутствия общих атрибутов?
    <details>
      <summary>Ответ</summary>

      $A \text{ TIMES } B$

    </details>
        

# Практика

## Модель “Горнолыжные комплексы Сочи”

### Набор трасс (trails)

**Описание**

$T(ID_T, Name, Level, Length, HeightDiff, Resort)$

- $ID_T$ – ID строки
- $Name$ – название трассы
- $Level$ – уровень сложности трассы (’зеленый’, ‘синий’, ‘красный’, ‘черный’)
- $Length$ – протяженность трассы в метрах
- $HeightDiff$ – перепад высот в метрах
- $Resort$ – какому курорту трасса принадлежит (’Роза Хутор’, ‘Красная Поляна’, ‘Газпром’)
    
<details>
  <summary>Пример таблицы</summary>

    | ID_T | Name | Level | Length | HeightDiff | Resort |
    | --- | --- | --- | --- | --- | --- |
    | 0 | Тритон ниже 1600 | синий | 2045 | 250 | Роза Хутор |
    | 1 | Арбор | красный | 1910 | 365 | Роза Хутор |
    | 2 | Женский Олимпийский спуск ниже 1600 | черный | 2532 | 635 | Роза Хутор |
    | 3 | Плато | зеленый | 2055 | 180 | Роза Хутор |
    | 4 | Шамони 24 | синий | 1905 | 410 | Роза Хутор |
    | 5 | Аибга | черный | 1035 | 295 | Роза Хутор |
    | 6 | Аибга | красный | 254 | 30 | Красная Поляна |
    | 7 | Реликтовый лес | синий | 1875 | 453 | Красная Поляна |
    | 8 | Панорама | красный | 2863 | 740 | Красная Поляна |

</details>
    
    

### Стоимость скипассов

**Описание**

$SP(ID_SP, Tariff, Price, MinAge, MaxAge, Resort)$

- $ID_SP$ – ID строки
- $Tariff$ – название тарифа
- $Price$ – стоимость скипасса
- $MinAge$ – минимальный возраст пользователя скипасса
- $MaxAge$ – минимальный возраст пользователя скипасса (500 = ‘не определен’)
- $Resort$ – какому курорту тариф принадлежит (’Роза Хутор’, ‘Красная Поляна’, ‘Газпром’)

<details>
  <summary>Пример таблицы</summary>

    | ID_SP | Tariff | Price | MinAge | MaxAge | Resort |
    | --- | --- | --- | --- | --- | --- |
    | 0 | Сезонный ски-пасс | 59 220 | 15 | 500 | Роза Хутор |
    | 1 | Годовой ски-пасс | 68 220 | 15 | 500 | Роза Хутор |
    | 2 | Ски-пасс 1 день (взрослый) | 5 500 | 15 | 500 | Роза Хутор |
    | 3 | Ски-пасс 1 день (детский) | 2 850 | 7 | 14 | Роза Хутор |
    | 4 | Ски-пасс 2 дня (взрослый) | 10 350 | 15 | 500 | Роза Хутор |
    | 5 | Ски-пасс 2 дня (детский) | 5 250 | 7 | 14 | Роза Хутор |
    | 6 | Дневной (взрослый) | 4 600 | 15 | 500 | Красная Поляна |
    | 7 | Дневной (детский) | 2 600 | 7 | 14 | Красная Поляна |
    | 8 | Фаст-трек 1 день (взрослый) | 9 000 | 15 | 500 | Красная Поляна |

</details>
    
### Подъемники (lifts)

**Описание**

$L(ID_L, Name, Type, Length, OpenTime, CloseTime, Resort)$

- $ID_L$ – ID строки
- $Name$ – наименование подъемника
- $Type$ – тип подъемника (’гондольный’, ‘кресельный’, ‘бугельный’, ‘конвейерный’)
- $Length$ – протяженность подъемника в метрах
- $OpenTime$ – со скольки часов работает подъемник (опустим вечернее катание)
- $CloseTime$ – до скольки часов работает подъемник
- $Resort$ – на каком курорте находится подъемник (’Роза Хутор’, ‘Красная Поляна’, ‘Газпром’)

<details>
  <summary>Пример таблицы</summary>

    | ID_L | Name | Type | Length | OpenTime | CloseTime | Resort |
    | --- | --- | --- | --- | --- | --- | --- |
    | 0 | Олимпия | гондольный | 2341 | 08:15 | 18:00 | Роза Хутор |
    | 1 | Заповедный лес | гондольный | 1541 | 08:30 | 16:30 | Роза Хутор |
    | 2 | Эдельвейс | кресельный | 2658 | 09:05 | 15:40 | Роза Хутор |
    | 3 | Ювента | бугельный | 277 | 08:30 | 16:35 | Роза Хутор |
    | 5 | Восточный лес | гондольный | 1032 | 08:00 | 17:00 | Красная Поляна |

</details>
    

### Связка трасс и подъемников

*Здесь я могу вас обманывать по поводу того, с какой трассы куда можно съехать…*

**Описание**

$TLfrom(ID_TLf, LiftID, TrailFrom)$

- $ID_TLf$ – ID строки
- $LiftID$ – идентификатор подъемника
- $TrailFrom$ – по какой трассе можно съехать к этому подъемнику

<details>
  <summary>Пример таблицы</summary>

    | ID_TLf | LiftID | TrailFrom |
    | --- | --- | --- |
    | 0 | 1 | Б52 |
    | 1 | 1 | Плато |
    | 2 | 2 | Панорама |
    | 3 | 2 | Явор |
    | 5 | 2 | Азалия |

</details>

$TLto(ID_TLt, LiftID, TrailTo)$

- $ID_TLt$ – ID строки
- $LiftID$ – идентификатор подъемника
- $TrailTo$ – на какую трассу можно съехать с этого подъемника

<details>
  <summary>Пример таблицы</summary>

    | ID_TLt | LiftID | TrailTo |
    | --- | --- | --- |
    | 0 | 2 | Горицвет |
    | 1 | 3 | Родельбан |
    | 2 | 1 | Ванкувер 10 |
    | 3 | 1 | Шамони 24 |
    | 5 | 1 | Озерная |

</details>


## Задания

На языке реляционной алгебры написать следующие запросы:

1. Вывести всю информацию по трассам Красной Поляны.

<details>
  <summary>Предполагаемый результат</summary>

        | ID_T | Name | Level | Length | HeightDiff | Resort |
        | --- | --- | --- | --- | --- | --- |
        | 6 | Аибга | красный | 254 | 30 | Красная Поляна |
        | 7 | Реликтовый лес | синий | 1875 | 453 | Красная Поляна |
        | 8 | Панорама | красный | 2863 | 740 | Красная Поляна |

</details>

<details>
  <summary>Решение</summary>

$$T[Resort = 'Красная Поляна']$$

</details>
        
2. Найти названия всех красных трасс.
<details>
  <summary>Предполагаемый результат</summary>

        | Name |
        | --- |
        | Арбор |
        | Аибга |
        | Панорама |


</details>

<details>
  <summary>Решение</summary>

$$T[Level = 'красный']$$

</details>
          
3. Вывести все синие трассы протяженностью более 2 километров. В ответе ожидаются атрибуты Name, Length, Resort.
<details>
  <summary>Предполагаемый результат</summary>

        | Name | Length | Resort |
        | --- | --- | --- |
        | Тритон ниже 1600 | синий | 2045 |

</details>

<details>
  <summary>Решение</summary>

$$T[Level = 'синий'][Length > 2000][Name, Length, Resort]$$

</details>

4. Вывести все скипассы для взрослых (15+ лет) стоимостью не более 15 000. В ответе ожидаются атрибуты Tariff, Price, Resort.
<details>
  <summary>Предполагаемый результат</summary>

        | Tariff | Price | Resort |
        | --- | --- | --- |
        | Ски-пасс 1 день (взрослый) | 5 500 | Роза Хутор |
        | Ски-пасс 2 дня (взрослый) | 10 350 | Роза Хутор |
        | Дневной (взрослый) | 4 600 | Красная Поляна |
        | Фаст-трек 1 день (взрослый) | 9 000 | Красная Поляна |

</details>

<details>
  <summary>Решение</summary>

$$SP[MinAge >= 15][Price <= 15000][Tariff, Price, Resort]$$

</details>
        
5. Алёна новичок и пока катается только на пологих зелёных трассах. Необходимо вывести все зелёные трассы, у которых среднее падение высоты на 1м трассы (новое поле $Coeff$) ниже 0.1 м. В ответе ожидаются атрибуты Name, Coeff, Resort.
<details>
  <summary>Предполагаемый результат</summary>

        | Name | Coeff | Resort |
        | --- | --- | --- |
        | Плато | 0,08759 | Роза Хутор |

</details>

<details>
  <summary>Решение</summary>

$$T[Coeff] := T[HeightDiff] / T[Length] \text{ примечание: это "псевдокод", Э.Кодд нас бы по голове не погладил.}$$
$$T[Level = 'зеленый'][Coeff < 0.1][Name, Coeff, Resort]$$

</details>

6. Найти названия всех трасс, по которым можно спуститься после подъема по “Заповедному лесу” на Розе Хутор.
    - План решения
        1. Получаем LiftID “Заповедного леса”
        2. Отбираем все трассы, по которым можно спуститься от этого подъемника
7. Артём обожает подъемник “Ювента” в Розе Хутор. Какие варианты маршрутов из двух трасс ему подходят? (Маршрут = спуск по произвольной трассе, подъем на “Ювенте” и повторный спуск по произвольной трассе)
8. Лёша, Лида и их 10-летний сын Паша приехали кататься на Красную Поляну. На семейном совете решили, что на скипассы они могут потратить не более 18 000 рублей. Какие варианты скипассов им подойдут? Ожидается, что каждый кортеж в ответе – это возможный набор скипассов: название скипасса для Лёши, Лиды и Паши и их суммарная стоимость.
9. Лена не любит экстрим, поэтому катается только на гондольных подъемниках. Начинает она свой день с подъема на “Заповедному лесу” в Розе Хутор. Какие маршруты из двух трасс мы можем ей предложить? (Маршрут = спуск от “Заповедного леса”, подъем на произвольном подъемнике, спуск по произвольной трассе)
10. Найти названия всех подъемников, с которых можно съезжать по синим трассам.

## Модель “Электроника”

### Продукт

**Описание**

$P(MK, MD, TP)$

- $MK$ – производитель.
- $MD$ – модель.
- $TP \in \{'PC', 'Tablet', 'Printer'\}$ – тип продукта.

### Персональный компьютер

**Описание**

$PC(\#PC, MD, SPD, RAM, HD, PRC)$

- $\#PC$ – ID товара.
- $MD$ – модель.
- $SPD$ – тактовая частота.
- $RAM$ – оперативная память.
- $HD$ – объем жесткого диска.
- $PRC$ – стоимость планшета.

### Планшет

**Описание**

$TB(\#TB, MD, SPD, RAM, HD, SCR, PRC)$

- $\#TB$ – ID товара.
- $MD$ – модель.
- $SPD$ – тактовая частота.
- $RAM$ – оперативная память.
- $HD$ – объем жесткого диска.
- $SCR$ – экран.
- $PRC$ – стоимость планшета.

### Принтер

**Описание**

$PR(\#PR, MD, CLR, PRC)$

- $\#PR$ – ID товара.
- $MD$ – модель.
- $CLR \in \{'Y', 'N'\}$ – цветной ли принтер.
- $PRC$ – стоимость принтера.

### Задания

1. Найти все кортежи отношения Принтер для цветных принтеров
2. Найти всех производителей принтеров
3. Найти номер модели, частоту и объем жесткого диска для всех ПК стоимостью менее
500 дол.
4. Найти номер модели, объем оперативной памяти и размеры экранов планшетов, цена
которых превышает 1000 дол.
5. Найти номер модели, частоту и объем жесткого диска ПК с оперативной памятью 2ГБ
и ценой менее 600 дол.
6. Найти производителей ПК с частотой не менее 450 МГц
7. Для каждого производителя, выпускающего планшеты c объёмом жесткого диска не
менее 10 ГБ, найти скорости таких планшетов
8. Найдите номера моделей и цены всех имеющихся в продаже продуктов (любого типа)
производителя ’B’
9. Найти производителей, которые выпускают ПК или планшеты с объемом оперативной
памяти не менее 2ГБ
10. Найдите производителей, выпускающих ПК, но не планшеты
11. Найдите производителей, которые выпускают как ПК, так и планшеты
12. Найти производителей, которые выпускают только принтеры, причем цветные
13. Найдите производителей, которые выпускают все планштеты с оперативной памятью 16 ГБ